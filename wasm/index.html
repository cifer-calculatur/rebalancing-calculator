<html lang="en">
<head>
    <meta charset="utf-8"/>
    <script src="wasm_exec.js"></script>
    <script type="module" src="js/components/cifer-asset-allocation.js"></script>
    <script>
        async function runCalculation() {
            const assetAllocation = document.querySelector('cifer-asset-allocation').assetAllocation;
            const amountToInvest = parseFloat(document.getElementById('amount').value);

            try {
                const result = calculateRebalance(assetAllocation, amountToInvest);

                if (result instanceof Error) {
                    console.error("Error calculating rebalance:", result.message);
                } else {
                    displayResults(result);
                }
            } catch (err) {
                // Catch potential errors during the WASM call itself
                console.error("Error calling WASM function:", err);
            }
        }

        function displayResults(data) {
            document.querySelector('pre').innerText = JSON.stringify(data, null, 2);
        }

        const go = new Go();
        WebAssembly.instantiateStreaming(fetch("build/main.wasm"), go.importObject).then((result) => {
            go.run(result.instance);
        });

        window.addEventListener('load', () => {
            document.querySelector('button[name="calc"]').addEventListener('click', runCalculation);
        });
    </script>
    <title>CiFeR - Cash Flow Rebalancing Calculator</title>
</head>
<body>
    <cifer-asset-allocation></cifer-asset-allocation>
    <label>
        Amount to invest:
        <input type="number" id="amount" value="380.00" step="0.01"/>
    </label>
    <button name="calc">Calculate</button>
    <pre></pre>
</body>
</html>
